<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sdstc.dao.UserDao">
	<resultMap id="RoleMap" type="com.sdstc.model.Role">
		<id column="id" property="id" />
		<result column="code" property="code" />
		<result column="name" property="name" />
	</resultMap>

	<resultMap id="PermMap" type="com.sdstc.model.Perm">
		<id column="id" property="id" />
		<result column="code" property="code" />
		<result column="name" property="name" />
	</resultMap>

	<resultMap id="UserInfoMap" type="com.sdstc.model.UserInfo">
		<id column="id" property="id" />
		<result column="account" property="account" />
		<result column="pwd" property="pwd" />
	</resultMap>

	<resultMap id="CustomerMap" type="com.sdstc.model.Customer">
		<id column="id" property="id" />
		<result column="name" property="name" />
	</resultMap>

 
	<select id="getRolesByUser" resultMap="RoleMap">
        select 
          t2.id,t2.code,t2.name 
        from 
          sys_user_role t1
		  left join sys_role t2 on t1.role_id=t2.id
		where 
		t1.user_account=#{account}
		and t1.customer_id=#{customerId}        
	</select>

	<select id="getPermsByUser" resultMap="PermMap">
       select 
         t3.id,t3.code,t3.name 
       from 
         sys_role_perm t1
		 left join sys_user_role t2 on t1.role_id=t2.role_id
		 left join sys_perm t3 on t1.perm_id=t3.id
      where 
		 t2.user_account=#{account}
		 and t2.customer_id=#{customerId}  
	</select>

	<select id="getCustomersByUser" resultMap="CustomerMap">
         select 
           DISTINCT(t1.customer_id) as id
         from 
           sys_user_customer t1
		 where 
		   t1.user_account=#{account}
		   and t1.state=1
	</select>

	<select id="getUser" resultMap="UserInfoMap">
         select 
           id,account,phone,email,pwd 
         from 
           sys_user
		 where 
		  (account=#{account} or phone=#{account} or email=#{account})
		  and state=1
	</select>
</mapper>